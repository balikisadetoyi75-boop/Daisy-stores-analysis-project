
--WHICH PRODUCTS ARE PERFORMING THE BEST?

--Revenue per category
SELECT 
	CATEGORY,
	SUM(OI.QUANTITY*OI.PRICE)  AS Total_revenue
FROM PRODUCT AS P
INNER JOIN ORDER_ITEMS AS OI
ON P.PRODUCT_ID=OI.PRODUCT_ID
GROUP BY CATEGORY
ORDER BY SUM(OI.QUANTITY*OI.PRICE) DESC;

-- Total revenue per product
SELECT 
	P.PRODUCT_ID,
	P.PRODUCT_NAME ,
	SUM(O.QUANTITY*O.PRICE) AS total_revenue
	FROM PRODUCT AS P INNER JOIN ORDER_ITEMS AS O
ON P.PRODUCT_ID=O.PRODUCT_ID
GROUP BY 
	P.PRODUCT_ID,
	P.PRODUCT_NAME
ORDER BY total_revenue DESC


-- Total quantity sold per product
SELECT 
	P.PRODUCT_ID,
	P.PRODUCT_NAME ,
	SUM(O.QUANTITY) AS total_Quantity
	FROM PRODUCT AS P INNER JOIN ORDER_ITEMS AS O
ON P.PRODUCT_ID=O.PRODUCT_ID
GROUP BY 
	P.PRODUCT_ID,
	P.PRODUCT_NAME
ORDER BY total_Quantity DESC


-- Number of orders containing the product
SELECT 
	P.PRODUCT_ID,
	P.PRODUCT_NAME ,
	COUNT(O.ORDER_ID) AS total_Orders
	FROM PRODUCT AS P INNER JOIN ORDER_ITEMS AS O
ON P.PRODUCT_ID=O.PRODUCT_ID
GROUP BY 
	P.PRODUCT_ID,
	P.PRODUCT_NAME
ORDER BY total_Orders DESC;

--WHAT IS THE TOTAL REVENUE GENERATED BY EACH PRODUCT IN THE LAST THREE MONTHS?

--REVENUE BY MONTH 

SELECT
	P.PRODUCT_ID, 
	P.PRODUCT_NAME, 
	O.ORDER_DATE,
	SUM(OI.QUANTITY*OI.PRICE) AS Total_revenue,
	MONTH(O.ORDER_DATE) AS Order_month
FROM PRODUCT AS P
INNER JOIN ORDER_ITEMS AS OI
	ON P.PRODUCT_ID=OI.PRODUCT_ID
INNER JOIN ORDERS AS O ON
	OI.ORDER_ID=O.ORDER_ID
WHERE O.ORDER_DATE >= DATEADD(MONTH, -3, '2025-02-01')
GROUP BY 
	P.PRODUCT_ID, 
	P.PRODUCT_NAME, 
	O.ORDER_DATE,
	MONTH(O.ORDER_DATE)
	ORDER BY O.ORDER_DATE DESC, Total_revenue DESC;


--WHICH CATEGORY IS THE TOP PERFOMER?
SELECT TOP 1
	CATEGORY,
	SUM(OI.QUANTITY*OI.PRICE)  AS Total_revenue
FROM PRODUCT AS P
INNER JOIN ORDER_ITEMS AS OI
ON P.PRODUCT_ID=OI.PRODUCT_ID
GROUP BY CATEGORY
ORDER BY SUM(OI.QUANTITY*OI.PRICE) DESC;


--WHICH CATEGORY IS THE UNDERPERFORMER COMPARED TO OVERALL AVERAGE?

SELECT TOP 1
	CATEGORY,
	SUM(OI.QUANTITY*OI.PRICE)  AS Total_revenue
FROM PRODUCT AS P
INNER JOIN ORDER_ITEMS AS OI
	ON P.PRODUCT_ID=OI.PRODUCT_ID
GROUP BY CATEGORY
HAVING SUM(OI.QUANTITY*OI.PRICE)  <
( 
SELECT 
	AVG(Category_rev) 
FROM(
	SELECT 
		CATEGORY,
		SUM(Oi.QUANTITY*Oi.PRICE) AS category_rev
FROM PRODUCT AS P 
	INNER JOIN ORDER_ITEMS AS Oi
		ON P.PRODUCT_ID=Oi.PRODUCT_ID
GROUP BY P.CATEGORY) AS Category_total_rev)
ORDER BY Total_revenue ASC;


